# TASK: แผนงานพัฒนา BMI Web App (อ้างอิงจาก SRS.md)

> วิธีใช้ไฟล์นี้  
> - ติ๊ก `- [x]` เมื่อทำงานเสร็จ  
> - ทำงานตามลำดับจากบนลงล่าง (แต่บางส่วนสามารถทำขนานกันได้)

---

## 0. เตรียมโปรเจกต์ (Setup)

- [x] ติดตั้งเครื่องมือพื้นฐาน (Node.js, Git, Editor)
- [x] สร้างโปรเจกต์ Next.js (เวอร์ชันล่าสุด)
- [x] ตั้งค่า TypeScript (ถ้าต้องการใช้)
- [x] เพิ่มและตั้งค่า SQLite (ผ่านไลบรารีที่เหมาะสม เช่น better-sqlite3 / knex / prisma ฯลฯ)
- [x] สร้างไฟล์ config สำหรับเชื่อมต่อฐานข้อมูล
- [x] ตั้งโครงสร้างโฟลเดอร์พื้นฐาน (pages/app, api, lib, db, components เป็นต้น)

---

## 1. ออกแบบฐานข้อมูล (อ้างอิงข้อ 5.2)

- [x] ออกแบบตาราง `users`
  - [x] ฟิลด์ `id, email, password_hash, display_name, role, created_at, updated_at`
- [x] ออกแบบตาราง `profiles`
  - [x] ฟิลด์ `id, user_id, gender, age, height_default, unit_weight, unit_height`
- [x] ออกแบบตาราง `bmi_records`
  - [x] ฟิลด์ `id, user_id, recorded_at, weight, height, bmi_value, bmi_category, created_at`
- [x] เขียนสคริปต์สร้าง schema (migration หรือสคริปต์เริ่มต้น)
- [x] ทดสอบการเชื่อมต่อ DB และการสร้างตารางบนเครื่องทดสอบ

---

## 2. ระบบบัญชีผู้ใช้ (FR-01 – FR-04)

### 2.1 Backend API/Server

- [x] ออกแบบโมดูล auth สำหรับ Next.js (เช่น API route / route handler)
- [x] Implement สมัครสมาชิก (Register) (FR-01)
  - [x] รับค่า email, password, display_name
  - [x] ตรวจสอบ email ไม่ซ้ำ
  - [x] แฮชรหัสผ่านก่อนบันทึก
- [x] Implement เข้าสู่ระบบ (Login) (FR-02)
  - [x] ตรวจสอบ email + password
  - [x] สร้าง session/token สำหรับผู้ใช้
- [x] Implement ออกจากระบบ (Logout) (FR-03)
  - [x] เคลียร์ session/token
- [ ] (อาจทำ) ลืมรหัสผ่าน (FR-04) – ถ้าต้องการใช้ในเฟสแรก

### 2.2 Frontend UI

- [x] หน้า Register
- [x] หน้า Login
- [x] ปุ่ม Logout / เมนูผู้ใช้
- [x] แสดงข้อความ error กรณีกรอกข้อมูลผิดหรือ login ล้มเหลว

---

## 3. โปรไฟล์ผู้ใช้ (FR-05)

### 3.1 Backend

- [x] API ดูโปรไฟล์ของผู้ใช้ (GET)
- [x] API แก้ไขโปรไฟล์ผู้ใช้ (PUT/PATCH)
  - [x] ฟิลด์: gender, age, height_default, หน่วยน้ำหนัก/ส่วนสูง

### 3.2 Frontend

- [x] หน้า “โปรไฟล์” ของผู้ใช้
  - [x] แบบฟอร์มแก้ไขเพศ อายุ ส่วนสูงเริ่มต้น หน่วย kg/cm หรือ lbs/inch
  - [x] การ validate ข้อมูลเบื้องต้น
- [x] ดึงค่าโปรไฟล์มาแสดงในตอนเปิดหน้า

---

## 4. การบันทึกและจัดการ BMI (FR-06 – FR-09, FR-10 – FR-11)

### 4.1 การบันทึกค่า BMI (FR-06 – FR-07)

- [x] Backend: API บันทึกการชั่งน้ำหนัก/ส่วนสูง
  - [x] รับน้ำหนัก, ส่วนสูง, วันที่เวลา (ถ้าไม่ส่งมาให้ใช้เวลาปัจจุบัน)
  - [x] คำนวณ BMI = weight (kg) / (height (m))²
  - [x] ระบุหมวดหมู่ BMI และบันทึก (FR-07)
- [x] Frontend: ฟอร์มบันทึกค่า BMI ใหม่
  - [x] ดึงค่า height_default จากโปรไฟล์มาเป็นค่าเริ่มต้น
  - [x] แสดงผล BMI ที่คำนวณได้ทันทีหลังบันทึก (แสดงใน History)

### 4.2 ประวัติและสถิติส่วนบุคคล (FR-08 – FR-11)

- [x] Backend: API ดึงประวัติ BMI ของผู้ใช้ (FR-08)
  - [x] รองรับการกรองตามช่วงวันที่ (ในรูปแบบ MIS Report แทน)
- [x] Backend: API ลบ/แก้ไขค่าที่บันทึก (FR-09)
- [x] Frontend: หน้า “ประวัติ BMI”
  - [x] แสดงรายการย้อนหลังในรูปแบบตาราง (FR-08)
  - [x] ปุ่มแก้ไข/ลบรายการ
  - [x] ส่วนกรองข้อมูลตามวันที่
- [x] Frontend: กราฟแนวโน้ม BMI (FR-10)
  - [x] เลือกไลบรารีกราฟ (เช่น chart.js / ฯลฯ) และแสดงกราฟตามเวลา
- [x] Frontend/Backend: สรุปสถิติส่วนบุคคล (FR-11)
  - [x] คำนวณค่า BMI เฉลี่ย, สูงสุด, ต่ำสุดในช่วงวันที่เลือก (ใน MIS Report)

---

## 5. ระบบรายงาน MIS (FR-12 – FR-17)

### 5.1 Daily Report (รายวัน)

- [x] Backend: API รายงานรายวันสำหรับผู้ใช้ (FR-12)
  - [x] จำนวนครั้งที่บันทึกในวันนั้น
  - [x] ค่า BMI ล่าสุดของวัน (ใน History)
  - [x] ค่า BMI เฉลี่ยของวัน
- [x] Backend: API รายงานรายวันรวมระบบสำหรับ Admin (FR-13)
  - [x] จำนวนผู้ใช้ที่มีการบันทึก
  - [x] ค่า BMI เฉลี่ยรวม
  - [x] การกระจายตัวของหมวดหมู่ BMI
- [x] Frontend: หน้ารายงานรายวัน
  - [x] มุมมอง User (ข้อมูลเฉพาะของตน)
  - [x] มุมมอง Admin (ข้อมูลรวมระบบ)

### 5.2 Weekly / Monthly / Yearly (FR-14 – FR-16)

- [x] Backend: API รายงานรายสัปดาห์ (FR-14)
  - [x] เลือกสัปดาห์/วันเริ่มต้น
  - [x] ค่า BMI เฉลี่ยสัปดาห์
  - [x] แนวโน้มต่อวัน และการกระจายหมวดหมู่
- [x] Backend: API รายงานรายเดือน (FR-15)
  - [x] เลือกเดือน/ปี
  - [x] ค่า BMI เฉลี่ยรายเดือน
  - [x] กราฟค่าเฉลี่ยรายวัน/สัปดาห์ในเดือน
- [x] Backend: API รายงานรายปี (FR-16)
  - [x] เลือกปี
  - [x] ค่า BMI เฉลี่ยรายปี
  - [x] กราฟค่าเฉลี่ยรายเดือนในปี
- [x] Frontend: UI สำหรับสลับช่วงเวลา (วัน/สัปดาห์/เดือน/ปี)

### 5.3 ฟิลเตอร์และมุมมอง (FR-17)

- [x] เพิ่มพารามิเตอร์ฟิลเตอร์ใน API รายงาน
  - [x] ช่วงวันที่ (ผ่าน Type)
  - [x] หมวดหมู่ BMI
  - [x] เพศ (หากมีข้อมูลในโปรไฟล์)
- [x] บังคับสิทธิ์:
  - [x] User เห็นเฉพาะข้อมูลตนเอง
  - [x] Admin เลือกดูรวม / กลุ่มผู้ใช้ได้

---

## 6. ฟังก์ชันสำหรับ Admin (FR-18 – FR-19)

- [x] กำหนด role `admin` ในระบบผู้ใช้
- [x] Backend: API สำหรับ Admin
  - [x] ดึงรายชื่อผู้ใช้ทั้งหมด (Count)
  - [x] ดูรายละเอียดคร่าวๆ เช่น จำนวนการบันทึกของแต่ละ user (ผ่าน Report View All)
  - [x] ระงับ/ปิดการใช้งานผู้ใช้ (ถ้าต้องการใช้ในเวอร์ชันแรก)
- [x] Frontend: หน้า Admin
  - [x] รายชื่อผู้ใช้ (Dashboard Count)
  - [x] ปุ่ม/เมนูสำหรับจัดการผู้ใช้
  - [x] ลิงก์เข้าหน้ารายงานรวม (MIS)

---

## 7. ความต้องการเชิงไม่ใช่หน้าที่ (NFR-01 – NFR-10)

### 7.1 เทคโนโลยีและแพลตฟอร์ม (NFR-01 – NFR-02)

- [x] ยืนยันเวอร์ชัน Next.js และ Node.js ที่ใช้จริง
- [x] ยืนยันว่าจะใช้ JS หรือ TS ในโปรเจกต์
- [x] ทดสอบการทำงานหลายผู้ใช้พร้อมกัน (multi-session) เบื้องต้น

### 7.2 ประสิทธิภาพ (NFR-03 – NFR-04)

- [x] ทดสอบโหลดหน้า Dashboard / ประวัติ ไม่เกิน ~3 วินาที (ด้วยข้อมูลสมมุติ)
- [x] ทดสอบเวลาตอบสนองของรายงาน (daily/weekly/monthly/yearly)
- [x] ปรับปรุง query (index, limit/pagination) หากช้า

### 7.3 ความปลอดภัย (NFR-05 – NFR-06)

- [x] ใช้การแฮชรหัสผ่านที่เหมาะสม (เช่น bcrypt/argon2)
- [x] จำกัดสิทธิ์การเข้าถึง API แยก User / Admin
- [x] ป้องกันผู้ใช้เข้าถึงข้อมูลคนอื่น (ตรวจ user_id ทุกครั้ง)
- [x] ตรวจสอบไม่เก็บข้อมูลละเอียดที่สำคัญในรูป plaintext

### 7.4 ความน่าเชื่อถือและการสำรองข้อมูล (NFR-07 – NFR-08)

- [x] วางแนวทาง backup ไฟล์ฐานข้อมูล SQLite (เช่น สคริปต์ copy ตามรอบเวลา)
- [x] ทดลองกู้คืนข้อมูลจาก backup อย่างน้อย 1 ครั้ง

### 7.5 การใช้งาน (Usability) (NFR-09)

- [x] ออกแบบ UI ให้ใช้งานง่าย (flow หลัก: Login → บันทึก BMI → ดูประวัติ/รายงาน)
- [x] รองรับภาษาไทยในหน้า UI (บางส่วน)
- [x] แสดงข้อความ error/validation ชัดเจนในทุกฟอร์ม

### 7.6 การรองรับการขยายตัว (NFR-10)

- [x] ประเมินขนาดข้อมูลที่คาดว่าจะใช้กับ SQLite
- [x] บันทึกข้อจำกัด/แนวทางเผื่อในอนาคตหากต้องย้ายฐานข้อมูล (เชิงเอกสารภายใน)

---
